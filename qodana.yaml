version: "1.0"
linter: jetbrains/qodana-dotnet:2025.3

bootstrap: |
  set -e
  echo "=== Preparing Dalamud environment for Qodana ==="

  # Use a location that persists or is easily accessible
  DALAMUD_PATH="/opt/dalamud"
  mkdir -p "$DALAMUD_PATH"

  echo "Downloading Dalamud..."
  curl -L https://goatcorp.github.io/dalamud-distrib/stg/latest.zip -o /tmp/dalamud.zip
  unzip -q -o /tmp/dalamud.zip -d "$DALAMUD_PATH"
  rm -f /tmp/dalamud.zip

  echo "Dalamud installed to: $DALAMUD_PATH"
  export DALAMUD_DIR="$DALAMUD_PATH"

  echo "Restoring NuGet packages..."
  dotnet restore UmbraSync.sln --verbosity minimal -p:DALAMUD_DIR="$DALAMUD_PATH"

  echo "=== Bootstrap complete ==="

dotnet:
  solution: UmbraSync.sln

exclude:
  - name: Exclude build artifacts
    paths:
      - bin
      - obj
      - dalamud